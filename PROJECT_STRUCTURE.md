# 项目结构说明

## 整体架构

```
eatwhat/
├── client/                 # 前端Vue.js应用
│   ├── Dockerfile         # 前端Docker构建文件
│   ├── nginx.conf         # 前端Nginx配置
│   └── .dockerignore      # 前端Docker忽略文件
├── server/                 # 后端Node.js应用
│   ├── Dockerfile         # 后端Docker构建文件
│   ├── .dockerignore      # 后端Docker忽略文件
│   └── scripts/
│       └── init-mongo.js  # MongoDB初始化脚本
├── docker-compose.yml      # Docker Compose主配置
├── docker-compose.prod.yml # 生产环境配置
├── nginx.conf              # 根目录Nginx配置
├── nginx.prod.conf         # 生产环境Nginx配置
├── deploy.sh               # 部署脚本
├── test-deployment.sh      # 部署测试脚本
├── env.template            # 环境变量模板
├── .dockerignore           # 根目录Docker忽略文件
└── README.md               # 项目说明文档
```

## 服务架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   用户浏览器     │    │   移动端应用     │    │   其他客户端     │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────▼─────────────┐
                    │      Nginx反向代理        │
                    │      (端口: 8080)        │
                    └─────────────┬─────────────┘
                                 │
          ┌───────────────────────┼───────────────────────┐
          │                       │                       │
┌─────────▼─────────┐    ┌────────▼────────┐    ┌────────▼────────┐
│   前端Vue应用      │    │   后端API服务    │    │   MongoDB数据库  │
│   (端口: 80)      │    │   (端口: 3000)  │    │   (端口: 27017) │
└───────────────────┘    └─────────────────┘    └─────────────────┘
```

## 容器网络架构

```
┌─────────────────────────────────────────────────────────────┐
│                    eatwhat-network                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐        │
│  │  frontend   │  │   backend   │  │   mongodb   │        │
│  │   :80       │  │   :3000     │  │   :27017    │        │
│  └─────────────┘  └─────────────┘  └─────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

## 数据流说明

### 1. 前端请求流程
```
用户请求 → Nginx代理 → 前端容器 → 静态资源响应
```

### 2. API请求流程
```
用户请求 → Nginx代理 → 后端容器 → MongoDB → 数据响应
```

### 3. 文件上传流程
```
用户上传 → Nginx代理 → 后端容器 → 存储到uploads目录
```

## 端口分配

| 服务 | 容器端口 | 主机端口 | 说明 |
|------|----------|----------|------|
| 前端 | 80 | 8081 | Vue.js应用 |
| 后端 | 3000 | 3000 | Node.js API |
| MongoDB | 27017 | 27017 | 数据库服务 |
| Nginx代理 | 80 | 8080 | 反向代理 |

## 数据持久化

### 1. MongoDB数据
- 存储位置: `./data/mongodb/`
- 容器路径: `/data/db`
- 备份策略: 定期备份到 `./backup/` 目录

### 2. 上传文件
- 存储位置: `./server/uploads/`
- 容器路径: `/app/uploads`
- 备份策略: 与数据库一起备份

### 3. 日志文件
- 存储位置: `./logs/`
- 分类: `mongodb/`, `backend/`, `nginx/`

## 环境配置

### 开发环境
- 使用 `docker-compose.yml`
- 端口映射到localhost
- 开发模式日志输出

### 生产环境
- 使用 `docker-compose.prod.yml`
- 资源限制和健康检查
- 生产模式日志配置
- HTTPS支持（需要SSL证书）

## 部署流程

### 1. 开发环境部署
```bash
# 启动所有服务
./deploy.sh start

# 查看状态
./deploy.sh status

# 查看日志
./deploy.sh logs
```

### 2. 生产环境部署
```bash
# 配置环境变量
cp env.template .env
# 编辑 .env 文件

# 启动生产环境
docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d

# 测试部署
./test-deployment.sh
```

## 监控和维护

### 1. 健康检查
- 所有服务都配置了健康检查
- 检查间隔: 30秒
- 超时时间: 10秒

### 2. 日志管理
- 结构化日志格式
- 日志轮转和清理
- 错误日志告警

### 3. 性能监控
- 容器资源使用监控
- API响应时间监控
- 数据库连接池监控

## 安全考虑

### 1. 网络安全
- 容器间通信隔离
- 端口访问控制
- 防火墙规则配置

### 2. 数据安全
- MongoDB认证
- 文件上传限制
- 敏感信息加密

### 3. 应用安全
- CORS配置
- 输入验证
- SQL注入防护

## 扩展性设计

### 1. 水平扩展
- 前端服务可多实例部署
- 后端API可负载均衡
- 数据库可主从复制

### 2. 垂直扩展
- 容器资源限制可调整
- 缓存策略可优化
- 数据库索引可优化

### 3. 微服务化
- 服务间解耦
- 独立部署和扩展
- 服务发现和注册 